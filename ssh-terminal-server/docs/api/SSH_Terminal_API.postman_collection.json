{"info": {"_postman_id": "ssh-terminal-sync-api", "name": "SSH Terminal Sync API", "description": "SSH Terminal 云端同步 API 完整测试集合", "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"}, "variable": [{"key": "base_url", "value": "http://localhost:3000", "type": "string", "description": "API 基础 URL"}, {"key": "access_token", "value": "", "type": "string", "description": "JWT 访问令牌（登录后自动设置）"}, {"key": "refresh_token", "value": "", "type": "string", "description": "JWT 刷新令牌（登录后自动设置）"}, {"key": "session_id", "value": "", "type": "string", "description": "SSH 会话 ID（创建后自动设置）"}, {"key": "user_id", "value": "", "type": "string", "description": "用户 ID（从响应中获取）"}, {"key": "language", "value": "zh-CN", "type": "string", "description": "语言设置（zh-CN 或 en）"}], "item": [{"name": "0. Health & Info", "item": [{"name": "0.1 Health Check", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "pm.test(\"Response has correct structure\", function () {", "  pm.expect(jsonData).to.have.property('code');", "  pm.expect(jsonData).to.have.property('message');", "  pm.expect(jsonData).to.have.property('data');", "  pm.expect(jsonData.data).to.have.property('status');", "  pm.expect(jsonData.data.status).to.eql('ok');", "});", "console.log(\"✅ 健康检查通过\")"]}}], "request": {"method": "GET", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/health", "host": ["{{base_url}}"], "path": ["health"]}, "description": "健康检查端点"}}, {"name": "0.2 Server Info", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "pm.test(\"Response has server info\", function () {", "  pm.expect(jsonData.data).to.have.property('name');", "  pm.expect(jsonData.data).to.have.property('version');", "  pm.expect(jsonData.data).to.have.property('status');", "  pm.expect(jsonData.data).to.have.property('timestamp');", "});", "console.log(\"✅ 服务器信息获取成功\");", "console.log(\"Server:\", jsonData.data.name, \"v\" + jsonData.data.version)"]}}], "request": {"method": "GET", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/info", "host": ["{{base_url}}"], "path": ["info"]}, "description": "获取服务器信息"}}]}, {"name": "1. Authentication", "item": [{"name": "1.1 Register", "event": [{"listen": "prerequest", "script": {"type": "text/javascript", "exec": ["// 清空 token（注册时不需要认证）", "pm.environment.set(\"access_token\", \"\");", "pm.environment.set(\"refresh_token\", \"\");"]}}, {"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200 or 409 (user exists)\", function () {", "    pm.expect(pm.response.code).to.be.oneOf([200, 409]);", "});", "", "if (pm.response.code === 200) {", "  const jsonData = pm.response.json();", "  pm.environment.set(\"access_token\", jsonData.data.access_token);", "  pm.environment.set(\"refresh_token\", jsonData.data.refresh_token);", "  pm.environment.set(\"user_id\", jsonData.data.user.id);", "  console.log(\"✅ 注册成功，token 已保存\");", "  console.log(\"User ID:\", jsonData.data.user.id);", "} else {", "  console.log(\"⚠️  用户已存在，请直接登录\");", "}"]}}], "request": {"method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"Password123!\"\n}"}, "url": {"raw": "{{base_url}}/auth/register", "host": ["{{base_url}}"], "path": ["auth", "register"]}, "description": "注册新用户"}}, {"name": "1.2 Login", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "", "const jsonData = pm.response.json();", "pm.environment.set(\"access_token\", jsonData.data.access_token);", "pm.environment.set(\"refresh_token\", jsonData.data.refresh_token);", "console.log(\"✅ 登录成功，token 已保存\");", "console.log(\"Access Token:\", jsonData.data.access_token.substring(0, 20) + \"...\");", "console.log(\"Refresh Token:\", jsonData.data.refresh_token.substring(0, 20) + \"...\");"]}}], "request": {"method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"Password123!\"\n}"}, "url": {"raw": "{{base_url}}/auth/login", "host": ["{{base_url}}"], "path": ["auth", "login"]}, "description": "用户登录"}}, {"name": "1.3 Refresh Token", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "", "const jsonData = pm.response.json();", "pm.environment.set(\"access_token\", jsonData.data.access_token);", "if (jsonData.data.refresh_token) {", "  pm.environment.set(\"refresh_token\", jsonData.data.refresh_token);", "}", "console.log(\"✅ Token 刷新成功\");"]}}], "request": {"method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}"}, "url": {"raw": "{{base_url}}/auth/refresh", "host": ["{{base_url}}"], "path": ["auth", "refresh"]}, "description": "刷新访问令牌"}}, {"name": "1.4 Delete Refresh Token", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "console.log(\"✅ 刷新令牌已删除\");", "pm.environment.set(\"refresh_token\", \"\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/auth/delete-refresh-token", "host": ["{{base_url}}"], "path": ["auth", "delete-refresh-token"]}, "description": "删除刷新令牌（退出登录）"}}, {"name": "1.5 Delete Account", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "console.log(\"✅ 账号已删除（软删除）\");", "// 清空环境变量", "pm.environment.set(\"access_token\", \"\");", "pm.environment.set(\"refresh_token\", \"\");", "pm.environment.set(\"user_id\", \"\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"user_id\": \"{{user_id}}\",\n  \"password\": \"Password123!\"\n}"}, "url": {"raw": "{{base_url}}/auth/delete", "host": ["{{base_url}}"], "path": ["auth", "delete"]}, "description": "删除账号（需要密码确认）"}}]}, {"name": "2. User Profile", "item": [{"name": "2.1 Get Profile", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "console.log(\"✅ 获取用户资料成功\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "GET", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/api/user/profile", "host": ["{{base_url}}"], "path": ["api", "user", "profile"]}, "description": "获取当前用户资料"}}, {"name": "2.2 Update Profile", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ 用户资料更新成功，server_ver:\", jsonData.data.server_ver);"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "PUT", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"username\": \"张三\",\n  \"phone\": \"13800138000\",\n  \"qq\": \"123456789\",\n  \"wechat\": \"wx123456\",\n  \"bio\": \"全栈开发工程师\"\n}"}, "url": {"raw": "{{base_url}}/api/user/profile", "host": ["{{base_url}}"], "path": ["api", "user", "profile"]}, "description": "创建或更新用户资料"}}, {"name": "2.3 Delete Profile", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "console.log(\"✅ 用户资料已删除（软删除）\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "DELETE", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/api/user/profile", "host": ["{{base_url}}"], "path": ["api", "user", "profile"]}, "description": "删除用户资料（软删除）"}}]}, {"name": "3. SSH Sessions", "item": [{"name": "3.1 Get All Sessions", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ 获取到\", jsonData.data.data.length, \"个 SSH 会话\");", "console.log(\"总数:\", jsonData.data.total);"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "GET", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/api/ssh/sessions?page=1&page_size=20", "host": ["{{base_url}}"], "path": ["api", "ssh", "sessions"], "query": [{"key": "page", "value": "1"}, {"key": "page_size", "value": "20"}]}, "description": "获取所有 SSH 会话（分页）"}}, {"name": "3.2 Create Session", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "pm.environment.set(\"session_id\", jsonData.data.id);", "console.log(\"✅ SSH 会话创建成功，ID:\", jsonData.data.id);", "console.log(\"Server Version:\", jsonData.data.server_ver);"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"name\": \"生产服务器\",\n  \"host\": \"192.168.1.100\",\n  \"port\": 22,\n  \"username\": \"root\",\n  \"group_name\": \"生产环境\",\n  \"terminal_type\": \"xterm-256color\",\n  \"columns\": 80,\n  \"rows\": 24,\n  \"auth_method_encrypted\": \"encrypted_password_here\",\n  \"auth_nonce\": \"random_nonce_16bytes\",\n  \"auth_key_salt\": \"random_salt_32bytes\"\n}"}, "url": {"raw": "{{base_url}}/api/ssh/sessions", "host": ["{{base_url}}"], "path": ["api", "ssh", "sessions"]}, "description": "创建新的 SSH 会话"}}, {"name": "3.3 Get Session", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "console.log(\"✅ 获取 SSH 会话成功\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "GET", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/api/ssh/sessions/{{session_id}}", "host": ["{{base_url}}"], "path": ["api", "ssh", "sessions", "{{session_id}}"]}, "description": "获取单个 SSH 会话详情"}}, {"name": "3.4 Update Session", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ SSH 会话更新成功，server_ver:\", jsonData.data.server_ver);"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "PUT", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"name\": \"生产服务器（已更新）\",\n  \"group_name\": \"生产环境\"\n}"}, "url": {"raw": "{{base_url}}/api/ssh/sessions/{{session_id}}", "host": ["{{base_url}}"], "path": ["api", "ssh", "sessions", "{{session_id}}"]}, "description": "更新 SSH 会话（部分更新）"}}, {"name": "3.5 Delete Session", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "console.log(\"✅ SSH 会话已删除（软删除）\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "DELETE", "header": [{"key": "Accept-Language", "value": "{{language}}"}], "url": {"raw": "{{base_url}}/api/ssh/sessions/{{session_id}}", "host": ["{{base_url}}"], "path": ["api", "ssh", "sessions", "{{session_id}}"]}, "description": "删除 SSH 会话（软删除）"}}]}, {"name": "4. Sync", "item": [{"name": "4.1 Full Sync (Pull + Push)", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ 同步成功\");", "console.log(\"- 服务器时间:\", new Date(jsonData.data.server_time * 1000));", "console.log(\"- 最后同步时间:\", new Date(jsonData.data.last_sync_at * 1000));", "console.log(\"- 更新会话数:\", jsonData.data.updated_session_ids.length);", "console.log(\"- 删除会话数:\", jsonData.data.deleted_session_ids.length);", "console.log(\"- 拉取会话数:\", jsonData.data.ssh_sessions.length);", "console.log(\"- 用户资料:\", jsonData.data.user_profile ? \"已更新\" : \"无变化\");", "console.log(\"- 冲突数:\", jsonData.data.conflicts.length);", "", "if (jsonData.data.conflicts.length > 0) {", "  console.log(\"\\n⚠️  检测到冲突，需要解决！\");", "  jsonData.data.conflicts.forEach((conflict, index) => {", "    console.log((index + 1) + \". 冲突 ID:\", conflict.id);", "    console.log(\"   类型:\", conflict.entity_type);", "    console.log(\"   客户端版本:\", conflict.client_ver);", "    console.log(\"   服务器版本:\", conflict.server_ver);", "    console.log(\"   消息:\", conflict.message);", "  });", "}"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"last_sync_at\": null,\n  \"device_id\": \"postman-test-device\",\n  \"user_profile\": {\n    \"bio\": \"通过 Postman 更新的简介\"\n  },\n  \"ssh_sessions\": [\n    {\n      \"id\": \"{{session_id}}\",\n      \"name\": \"通过 Postman 更新的会话\",\n      \"host\": \"192.168.1.100\",\n      \"port\": 22,\n      \"username\": \"root\",\n      \"group_name\": \"测试环境\",\n      \"terminal_type\": \"xterm-256color\",\n      \"columns\": 80,\n      \"rows\": 24,\n      \"auth_method_encrypted\": \"encrypted_data\",\n      \"auth_nonce\": \"nonce_value\",\n      \"auth_key_salt\": \"salt_value\",\n      \"client_ver\": 1,\n      \"created_at\": 1706227200,\n      \"updated_at\": 1706227200\n    }\n  ],\n  \"deleted_session_ids\": []\n}"}, "url": {"raw": "{{base_url}}/api/sync", "host": ["{{base_url}}"], "path": ["api", "sync"]}, "description": "统一同步（先 Push 后 Pull）"}}, {"name": "4.2 Resolve Conflict - Keep Server", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ 冲突已解决（保留服务器版本）\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"conflict_id\": \"{{session_id}}\",\n  \"strategy\": \"keep_server\"\n}"}, "url": {"raw": "{{base_url}}/api/sync/resolve-conflict", "host": ["{{base_url}}"], "path": ["api", "sync", "resolve-conflict"]}, "description": "解决冲突 - 保留服务器版本"}}, {"name": "4.3 Resolve Conflict - Keep Local", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ 冲突已解决（保留本地版本）\");"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"conflict_id\": \"{{session_id}}\",\n  \"strategy\": \"keep_local\",\n  \"client_data\": {\n    \"id\": \"{{session_id}}\",\n    \"name\": \"本地版本会话\",\n    \"host\": \"192.168.1.100\",\n    \"port\": 22,\n    \"username\": \"root\"\n  }\n}"}, "url": {"raw": "{{base_url}}/api/sync/resolve-conflict", "host": ["{{base_url}}"], "path": ["api", "sync", "resolve-conflict"]}, "description": "解决冲突 - 保留本地版本"}}, {"name": "4.4 Resolve Conflict - Keep Both", "event": [{"listen": "test", "script": {"type": "text/javascript", "exec": ["pm.test(\"Status code is 200\", function () {", "  pm.response.to.have.status(200);", "});", "const jsonData = pm.response.json();", "console.log(\"✅ 冲突已解决（保留两个版本）\");", "console.log(\"新会话 ID:\", jsonData.data.new_id);"]}}], "request": {"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]}, "method": "POST", "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Accept-Language", "value": "{{language}}"}], "body": {"mode": "raw", "raw": "{\n  \"conflict_id\": \"{{session_id}}\",\n  \"strategy\": \"keep_both\"\n}"}, "url": {"raw": "{{base_url}}/api/sync/resolve-conflict", "host": ["{{base_url}}"], "path": ["api", "sync", "resolve-conflict"]}, "description": "解决冲突 - 创建副本保留两个版本"}}]}]}